<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Ketrew" rel="Chapter" href="Ketrew.html">
<link title="Ketrew_artifact" rel="Chapter" href="Ketrew_artifact.html">
<link title="Ketrew_database" rel="Chapter" href="Ketrew_database.html">
<link title="Ketrew_host" rel="Chapter" href="Ketrew_host.html">
<link title="Ketrew_long_running" rel="Chapter" href="Ketrew_long_running.html">
<link title="Ketrew_monitored_script" rel="Chapter" href="Ketrew_monitored_script.html">
<link title="Ketrew_nohup_setsid" rel="Chapter" href="Ketrew_nohup_setsid.html">
<link title="Ketrew_path" rel="Chapter" href="Ketrew_path.html">
<link title="Ketrew_pervasives" rel="Chapter" href="Ketrew_pervasives.html">
<link title="Ketrew_state" rel="Chapter" href="Ketrew_state.html">
<link title="Ketrew_target" rel="Chapter" href="Ketrew_target.html">
<link title="Ketrew_unix_process" rel="Chapter" href="Ketrew_unix_process.html"><title>Ketrew API : Ketrew_long_running</title>
</head>
<body>
<code class="code"></code><table><tr><td></td><td><span class="comment">(** Definition of the interface required from “long-running task” plugins. *)</span></td></tr></table><code class="code"><br>
<br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Ketrew_pervasives</span><br>
<br>
</code><table><tr><td></td><td><span class="comment">(** The module type <code class="code"><span class="constructor">LONG_RUNNING</span></code> defines the interface for plugins. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">module</span>&nbsp;<span class="keyword">type</span>&nbsp;<span class="constructor">LONG_RUNNING</span>&nbsp;=&nbsp;<span class="keyword">sig</span><br>
<br>
&nbsp;&nbsp;<span class="keyword">type</span>&nbsp;run_parameters<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Hidden type kept serialized by the engine. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;name:&nbsp;string<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** The (unique) name of the plugin. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;serialize:&nbsp;run_parameters&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;string<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Serialize the run parameters for storage by the engine. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;deserialize_exn:&nbsp;string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;run_parameters<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Deserialize the run parameters from a string; the engine guaranties
      that <code class="code">deserialize_exn</code> will be called onthe result of <code class="code">serialize</code>;
      and assumes that no exception will be thrown in that case. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;start:&nbsp;run_parameters&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(run_parameters,&nbsp;[&gt;&nbsp;&nbsp;<span class="keywordsign">`</span><span class="constructor">Failed_to_start</span>&nbsp;<span class="keyword">of</span>&nbsp;string])&nbsp;<span class="constructor">Deferred_result</span>.t<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Start the long-running computation, the returned <code class="code">run_parameters</code> will be
      stored and used for the first call to <code class="code">update</code>. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;update:&nbsp;run_parameters&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;([<span class="keywordsign">`</span><span class="constructor">Succeeded</span>&nbsp;<span class="keyword">of</span>&nbsp;run_parameters<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Failed</span>&nbsp;<span class="keyword">of</span>&nbsp;run_parameters&nbsp;*&nbsp;string<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Still_running</span>&nbsp;<span class="keyword">of</span>&nbsp;run_parameters],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&gt;&nbsp;<span class="keywordsign">`</span><span class="constructor">Failed_to_update</span>&nbsp;<span class="keyword">of</span>&nbsp;string])&nbsp;<span class="constructor">Deferred_result</span>.t<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Check and update the status of the long-running job. Again, is
      <code class="code"><span class="keywordsign">`</span><span class="constructor">Still_running</span> rp</code> is returned, the next call to <code class="code">update</code> (or <code class="code">kill</code>)
      will receive those parameters. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;kill:&nbsp;run_parameters&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;([<span class="keywordsign">`</span><span class="constructor">Killed</span>&nbsp;<span class="keyword">of</span>&nbsp;run_parameters],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&gt;&nbsp;<span class="keywordsign">`</span><span class="constructor">Failed_to_kill</span>&nbsp;<span class="keyword">of</span>&nbsp;string])&nbsp;<span class="constructor">Deferred_result</span>.t<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Kill the long-running computation. *)</span></td></tr></table><code class="code"><br>
<br>
<span class="keyword">end</span><br>
</code></body></html>