 <!DOCTYPE html> <html> <head><link rel="stylesheet" href="https://cdn.rawgit.com/hammerlab/ketrew/2d1c430cca52caa71e363a765ff8775a6ae14ba9/src/doc/code_style.css" type="text/css">
<link rel="stylesheet" href="http://cdn.jsdelivr.net/bootstrap/3.1.1/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.jsdelivr.net/bootstrap/3.1.1/css/bootstrap-theme.min.css" type="text/css"><meta charset="utf-8"><title>Ketrew: Developer Documentation</title></head><body><div class="container"><h1>Ketrew: Developer Documentation</h1><div class="row">
<div class="col-md-3">
<h2>Contents</h2><ul>
 <li><a href='#Build'>Build</a>
  <ul>
   <li><a href='#GettingJustTheDependencies'>Getting Just The Dependencies</a>
   </li>
   <li><a href='#Build_1'>Build</a>
   </li>
   <li><a href='#Install'>Install</a>
   </li>
   <li><a href='#BuildTheDocumentation'>Build The Documentation</a>
   </li>
   <li><a href='#RunaToplevel'>Run a Toplevel</a>
   </li>
  </ul>

 </li>
 <li><a href='#Tests'>Tests</a>
  <ul>
   <li><a href='#AutomatedTests'>Automated Tests</a>
   </li>
   <li><a href='#ThecliTest'>The <code>cli</code> Test</a>
   </li>
   <li><a href='#GeneratingaTestEnvironment'>Generating a Test Environment</a>
   </li>
  </ul>

 </li>
</ul>
<h2>Menu</h2><ul>
 <li><a href='index.html'>Home</a></li>
 <li><a href='Alternative_CLI_Application.html'>Alternative CLI Application</a></li>
 <li><a href='Developer_Documentation.html'>Developer Documentation</a></li>
 <li><a href='Long-Running_Plugins.html'>Long-Running Plugins</a></li>
 <li><a href='Server_Commands.html'>Server Commands</a></li>
 <li><a href='The_Configuration_File.html'>The Configuration File</a></li>
 <li><a href='The_HTTP_API.html'>The HTTP API</a></li>
 <li><a href='dummy_plugin.html'>Plugin Example</a></li>
 <li><a href='dummy_plugin_user.html'>Plugin-Usage Example</a></li>
 <li><a href='integration.html'>Integration Test</a></li>
 <li><a href='main.html'>Main Test</a></li>
 <li><a href='preconfigured_main.html'>Preconfigured Main Example</a></li>
 <li><a href='Workflow_Examples.html'>Workflow Examples</a></li>
 <li><a href='./api/index.html'>API Documentation</a></li>
</ul>
</div><div class="col-md-9"><h1 id="DevelopmentDocumentation">Development Documentation</h1>
<h2 id="Build">Build</h2>
<h3 id="GettingJustTheDependencies">Getting Just The Dependencies</h3>
<p>Ketrew depends on</p>
<ul>
 <li><a href='api/html#VALnonstd' title='nonstd'><code>nonstd</code></a>: nano-library providing a portable extract of <a href='api/Core_kernel.html' title='Core_kernel'><code>Core_kernel</code></a></li>
 <li><a href='api/html#VALpvem' title='pvem'><code>pvem</code></a>: error monad</li>
 <li><a href='api/html#VALdocout' title='docout'><code>docout</code></a>: logging with <code>smart-print</code></li>
 <li><a href='api/html#VALsosa' title='sosa'><code>sosa</code></a>:  String module/functor</li>
 <li><a href='api/html#VALpvem_lwt_unix' title='pvem_lwt_unix'><code>pvem_lwt_unix</code></a>: <a href='api/Lwt_unix.html' title='Lwt_unix'><code>Lwt_unix</code></a> wrapped in a <a href='api/Pvem.html#TYPEt' title='Pvem.t'><code>Pvem.t</code></a> (error monad) with more
precise error types.</li>
 <li><code>uri</code>:
parse <a href='http://www.ietf.org/rfc/rfc3986.txt'>RFC-3986</a>-compliant URIs
(<code>uri</code> itself depends on <a href='api/html#VALcamlp4' title='camlp4'><code>camlp4</code></a>).</li>
 <li><a href='api/html#VALcmdliner' title='cmdliner'><code>cmdliner</code></a>: command line parsing</li>
 <li><a href='api/html#VALyojson' title='yojson'><code>yojson</code></a>: JSON parsing/printing</li>
 <li><a href='api/html#VALatd2cconv' title='atd2cconv'><code>atd2cconv</code></a>: definition of serialization formats (used with <a href='api/Yojson.html' title='Yojson'><code>Yojson</code></a>).</li>
 <li><a href='api/html#VALtoml' title='toml'><code>toml</code></a>: config-file parsing</li>
 <li><a href='api/cohttp.html#VALlwt' title='cohttp.lwt'><code>cohttp.lwt</code></a>, <code>ssl</code>, and <a href='api/html#VALconduit' title='conduit'><code>conduit</code></a>: HTTP server and client</li>
 <li><a href='api/html#VALfindlib' title='findlib'><code>findlib</code></a> + <a href='api/html#VALdynlink' title='dynlink'><code>dynlink</code></a>: dynamic loading of plugins </li>
</ul>

<p>and uses the <code>ocp-build</code> build system.</p>
<p>At runtime, Ketrew will use a reasonably recent <code>git</code> command, and an <code>ssh</code>
client (tested only with OpenSSH; but SSH calls are quite configurable).</p>
<p>The <a href='api/please.html#VALsh' title='please.sh'><code>please.sh</code></a> script can call <a href='api/html#VALopam' title='opam'><code>opam</code></a> itself:</p>
<pre><code>./please.sh get-dependencies</code></pre>
<h3 id="Build_1">Build</h3>
<p>Then you may setup and build everything:</p>
<pre><code>./please.sh build</code></pre>
<p>(for incremental compilation while developping please use: <code>ocp-build &lt;target&gt;</code>
directly)</p>
<h3 id="Install">Install</h3>
<p>For now, <a href='api/html#VALketrew' title='ketrew'><code>ketrew</code></a> uses a custom install/uninstall procedure:</p>
<pre><code>./please.sh install &lt;prefix&gt;</code></pre>
<p>and uninstall with:</p>
<pre><code>./please.sh uninstall &lt;prefix&gt;</code></pre>
<p>If you use Opam ≥ <em>1.2.0~beta4</em>, you don&#39;t need a custom opam-repository:</p>
<pre><code>./please.sh local-opam
opam pin add -k path ketrew .</code></pre>
<h3 id="BuildTheDocumentation">Build The Documentation</h3>
<p>The documentation depends on <a href='https://github.com/smondet/oredoc'>oredoc</a>:</p>
<pre><code>please.sh doc</code></pre>
<p>and check-out <code>_doc/&lt;branch&gt;/index.html</code> (unless branch is <a href='api/html#VALmaster' title='master'><code>master</code></a>, then
<code>_doc/index.html</code>).</p>
<h3 id="RunaToplevel">Run a Toplevel</h3>
<p>One can start an ocaml-toplevel (<a href='api/html#VALocaml' title='ocaml'><code>ocaml</code></a> or <a href='api/html#VALutop' title='utop'><code>utop</code></a>) with Ketrew loaded-in:</p>
<pre><code>./please.sh top</code></pre>
<h2 id="Tests">Tests</h2>
<h3 id="AutomatedTests">Automated Tests</h3>
<p>Run the tests like this:</p>
<pre class='bash'><code class='bash'>    ketrew_test_ssh=&lt;Host&gt; _obuild/ketrew-test/ketrew-test.asm [-no-color] ALL</code></pre>
<p>where <code>&lt;Host&gt;</code> is often an entry in your <code>.ssh/config</code> file.</p>
<p>The test will indeed look for the environment variable <a href='api/html#VALketrew_test_ssh' title='ketrew_test_ssh'><code>ketrew_test_ssh</code></a>; if
not defined it will use <code>&quot;localhost&quot;</code>. But for the test to succeed it should be
an SSH host for which the user running the test does not need password.
The test will run some commands on that host and create files and directories
in its <code>/tmp</code> directory.</p>
<h3 id="ThecliTest">The <code>cli</code> Test</h3>
<p>The workflow <a href='Workflow_Examples.html'>examples</a> in the documentation
are actually interactive tests.</p>
<h3 id="GeneratingaTestEnvironment">Generating a Test Environment</h3>
<p>In order to not impact a potential “global” installation of Ketrew, one can
use:</p>
<pre><code>./please.sh test-env</code></pre>
<pre class='goodresult'><code class='goodresult'>Using package lwt.react add findlin-plugin
Compiling the Dummy-plugin and its user

Creating cert-key pair: _obuild/test-cert.pem, _obuild/test-key.pem
Creating _obuild/test-config-file.toml
Creating _obuild/test-authorized-tokens
Creating _obuild/test.env</code></pre>
<p>then sourcing <code>_obuild/test.env</code> will give a few aliases to run the tests (like
<a href='api/html#VALkdtest' title='kdtest'><code>kdtest</code></a>, <a href='api/html#VALkdclient' title='kdclient'><code>kdclient</code></a>, etc. see inside the file).</p>
</div></div></div></body><html>